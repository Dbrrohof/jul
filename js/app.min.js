var config={apiKey:"AIzaSyBAnks7FMf2TNQE8m7z_oh9Vs-mbs16Okw",authDomain:"julelodtraekning.firebaseapp.com",databaseURL:"https://julelodtraekning.firebaseio.com",projectId:"julelodtraekning",storageBucket:"julelodtraekning.appspot.com",messagingSenderId:"490164122312"};firebase.initializeApp(config);var usersArray=[];var wishlistsArray=[];var bucketArray=[];var database=firebase.database();var storage=firebase.storage();var users=firebase.database().ref('users');var bucket=firebase.database().ref('hat').orderByValue().equalTo(0);var wishlists=firebase.database().ref('wishlists');users.on('value',function(snapshot){usersArray=snapshot.val();});wishlists.on('value',function(snapshot){wishlistsArray=snapshot.val();getWishlists();});var currentUser=sessionStorage.getItem("name");if(currentUser){document.getElementById('hello').innerHTML="Hej <span class='name'>"+currentUser+"</span>!";getNisse();}else{window.location="signup"}
function getNisse(){firebase.database().ref('/users/'+currentUser+'/nisse').once('value').then(function(snapshot){if(snapshot.val()=="none"||snapshot.val()==0||snapshot.val()==null){document.getElementById('answer').innerHTML="???"}else{document.getElementById('answer').innerHTML="Du er nisse for <span class='name'>"+snapshot.val()+"</span>";document.getElementById('nisseknap').disabled=true;document.getElementById('nisseknap').value="Du er en nisse!";}});}
function logOut(){sessionStorage.clear();currentUser=null;window.location="signup"}
function getAnswer(){document.getElementById('nisseknap').disabled=true;bucket.once('value',function(snapshot){bucketArray=Object.keys(snapshot.val());getAnswerReady();});}
function getAnswerReady(){console.log(bucketArray);let keys=Object.keys(bucketArray);let chosenNisse=bucketArray[keys[keys.length*Math.random()<<0]];console.log(chosenNisse,currentUser)
if(chosenNisse===currentUser&&keys.length>1){getAnswerReady();return;}else if(chosenNisse===currentUser&&keys.length==1){document.getElementById('answer').innerHTML="Øv... Der er ikke flere navne i posen";}
firebase.database().ref('users/'+currentUser).update({nisse:chosenNisse});document.getElementById('answer').innerHTML="Du er nisse for <span class='name'>"+chosenNisse+"</span>";firebase.database().ref('hat/').update({[chosenNisse]:1});}
function newPass(){var newPass=document.getElementById('newPassword').value;if(document.getElementById('newPassword').value==""){document.getElementById('passwordChanged').innerHTML="Husk at skrive en kode i feltet!";}
else{firebase.database().ref('users/'+currentUser).update({password:newPass});document.getElementById('passwordChanged').innerHTML="Din adgangskode er skiftet!";}}
function uploadWishlist(){if(document.getElementById("wishes").value==""){document.getElementById('noWishes').innerHTML="Husk at vælge en fil før du trykker på knappen :-)";}else{var fileUploadControl=document.getElementById('wishes');var file=fileUploadControl.files[0];let storageRef=firebase.storage().ref('wishlists/'+currentUser)
var task=storageRef.put(file);task.on('state_changed',function progress(snapshot){var percentage=(snapshot.bytesTransferred / snapshot.totalBytes)*100;console.log(percentage);},function error(err){},function complete(){let downloadurl=task.snapshot.downloadURL;firebase.database().ref('wishlists/'+currentUser).update({downloadurl});});}}
function getWishlists(){let listOfWishlists=document.getElementById('wishlistsInner');listOfWishlists.innerHTML="";var object=[];console.log()
for(var key in wishlistsArray){let listItem=document.createElement('li')
listItem.innerHTML='<a href="'+wishlistsArray[key].downloadurl+'" class="list-group-item" target="_blank">'+key+'</a>';listOfWishlists.appendChild(listItem);}}
function getNamesLeft(){firebase.database().ref('hat').orderByValue().equalTo(0).once('value').then(function(snapshot){console.log(snapshot.val())});}
function getPeoplePicked(){}